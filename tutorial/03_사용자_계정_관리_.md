# Chapter 3: ì‚¬ìš©ì ê³„ì • ê´€ë¦¬


ì•ˆë…•í•˜ì„¸ìš”! `SKN10-FINAL-2Team` í”„ë¡œì íŠ¸ íŠœí† ë¦¬ì–¼ì˜ ì„¸ ë²ˆì§¸ ì±•í„°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. [ì±•í„° 1: ìƒí’ˆ ë°ì´í„°ë² ì´ìŠ¤ ë° ì¡°íšŒ](01_ìƒí’ˆ_ë°ì´í„°ë² ì´ìŠ¤_ë°_ì¡°íšŒ_.md)ì—ì„œëŠ” ìš°ë¦¬ í”„ë¡œì íŠ¸ê°€ ì˜ì–‘ì œ ìƒí’ˆ ì •ë³´ë¥¼ ì–´ë–»ê²Œ ì²´ê³„ì ìœ¼ë¡œ ì €ì¥í•˜ê³  ì°¾ì•„ì˜¤ëŠ”ì§€ ë°°ì› ê³ , [ì±•í„° 2: ì¸ê¸° ì ìˆ˜ ê³„ì‚° ë¡œì§](02_ì¸ê¸°_ì ìˆ˜_ê³„ì‚°_ë¡œì§_.md)ì—ì„œëŠ” ìƒí’ˆì˜ 'ì§„ì •í•œ ì¸ê¸°'ë¥¼ ê°ê´€ì ìœ¼ë¡œ ì¸¡ì •í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.

ì´ì œ ì¤‘ìš”í•œ ì§ˆë¬¸ì´ ë‚¨ì•˜ìŠµë‹ˆë‹¤. "ëˆ„ê°€ ì´ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ”ê°€?", "ì‚¬ìš©ìëŠ” ì–´ë–»ê²Œ ì„œë¹„ìŠ¤ì— ì ‘ì†í•˜ê³  ìì‹ ì„ ì¸ì¦í•˜ëŠ”ê°€?" ì´ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µì´ ë°”ë¡œ `ì‚¬ìš©ì ê³„ì • ê´€ë¦¬`ì…ë‹ˆë‹¤.

## 1. 'ì„œë¹„ìŠ¤ì˜ ì‹ ë¶„ì¦ ë°œê¸‰ì†Œ': ì‚¬ìš©ì ê³„ì • ê´€ë¦¬ëŠ” ì™œ í•„ìš”í• ê¹Œìš”?

ì—¬ëŸ¬ë¶„ì´ ìƒˆë¡œìš´ ì›¹ì‚¬ì´íŠ¸ë‚˜ ì•±ì„ ì´ìš©í•˜ë ¤ê³  í•  ë•Œ ê°€ì¥ ë¨¼ì € í•˜ëŠ” ê²ƒì´ ë¬´ì—‡ì¸ê°€ìš”? ë³´í†µì€ 'íšŒì›ê°€ì…'ì„ í•˜ê±°ë‚˜, ì´ë¯¸ ê³„ì •ì´ ìˆë‹¤ë©´ 'ë¡œê·¸ì¸'ì„ í•  ê²ƒì…ë‹ˆë‹¤. ì´ì²˜ëŸ¼ ì‚¬ìš©ìê°€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ê¸° ìœ„í•œ ì²« ê´€ë¬¸ì´ ë°”ë¡œ `ì‚¬ìš©ì ê³„ì • ê´€ë¦¬`ì…ë‹ˆë‹¤.

ìš°ë¦¬ ì„œë¹„ìŠ¤ëŠ” ì‚¬ìš©ìê°€ ìì‹ ë§Œì˜ ê±´ê°• ì •ë³´ë¥¼ ê´€ë¦¬í•˜ê³ , ë§ì¶¤í˜• ì˜ì–‘ì œë¥¼ ì¶”ì²œë°›ìœ¼ë©°, ê°œì¸í™”ëœ ë§ˆì´í˜ì´ì§€ë¥¼ ì´ìš©í•  ìˆ˜ ìˆë„ë¡ ë•ìŠµë‹ˆë‹¤. ë§ˆì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ê¸° ìœ„í•œ 'ì‹ ë¶„ì¦'ì„ ë°œê¸‰í•˜ê³  ê´€ë¦¬í•˜ëŠ” 'ì‹ ë¶„ì¦ ë°œê¸‰ì†Œ'ì™€ ê°™ë‹¤ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë§Œì•½ ì‚¬ìš©ì ê³„ì •ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì–´ë–¤ ë¬¸ì œê°€ ìƒê¸¸ê¹Œìš”?
*   ì‚¬ìš©ìë§ˆë‹¤ ë‹¤ë¥¸ ë§ì¶¤ ì •ë³´ë¥¼ ì œê³µí•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.
*   ê°œì¸ì˜ êµ¬ë§¤ ë‚´ì—­ì´ë‚˜ ê´€ì‹¬ ìƒí’ˆì„ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
*   ë³´ì•ˆì´ ì·¨ì•½í•´ì ¸ ê°œì¸ ì •ë³´ê°€ ë…¸ì¶œë  ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.
*   ì„œë¹„ìŠ¤ ìš´ì˜ìëŠ” ëˆ„ê°€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ”ì§€ íŒŒì•…í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `ì‚¬ìš©ì ê³„ì • ê´€ë¦¬` ì‹œìŠ¤í…œì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ ì‹œìŠ¤í…œì€ ì‚¬ìš©ìê°€ 'ëˆ„êµ¬'ì¸ì§€ ì •í™•íˆ í™•ì¸í•˜ê³ , ì•ˆì „í•˜ê²Œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥:**
*   **íšŒì›ê°€ì…:** ìƒˆë¡œìš´ ì‚¬ìš©ìê°€ ì„œë¹„ìŠ¤ì— ê°€ì…í•©ë‹ˆë‹¤.
*   **ë¡œê·¸ì¸:** ê¸°ì¡´ ì‚¬ìš©ìê°€ ìì‹ ì˜ ê³„ì •ìœ¼ë¡œ ì„œë¹„ìŠ¤ì— ì ‘ì†í•©ë‹ˆë‹¤.
*   **ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°:** ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠì—ˆì„ ë•Œ ì¬ì„¤ì •í•  ìˆ˜ ìˆë„ë¡ ë•ìŠµë‹ˆë‹¤.
*   **ì†Œì…œ ë¡œê·¸ì¸:** êµ¬ê¸€ ê°™ì€ ì™¸ë¶€ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ê°„í¸í•˜ê²Œ ë¡œê·¸ì¸í•©ë‹ˆë‹¤.
*   **ì´ë©”ì¼ ì¸ì¦:** ê³„ì •ì˜ ë³´ì•ˆì„ ê°•í™”í•˜ê³ , ë³¸ì¸ì„ì„ í™•ì¸í•˜ëŠ” ì ˆì°¨ì…ë‹ˆë‹¤.

ì´ ì±•í„°ì—ì„œëŠ” ì‚¬ìš©ìê°€ íšŒì›ê°€ì…ì„ í•˜ê³  ë¡œê·¸ì¸í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ê³¼ì •ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì‚¬ìš©ì ê³„ì • ê´€ë¦¬ ì‹œìŠ¤í…œì˜ í•µì‹¬ ê¸°ëŠ¥ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

## 2. ì‚¬ìš©ì ê³„ì •, ë¬´ì—‡ì„ ê´€ë¦¬í•˜ë‚˜ìš”?

ì‚¬ìš©ì ê³„ì •ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ìš°ë¦¬ëŠ” ì–´ë–¤ ì •ë³´ë¥¼ ì €ì¥í•´ì•¼ í• ê¹Œìš”? ìš°ë¦¬ í”„ë¡œì íŠ¸ì—ì„œëŠ” `CustomUser`ë¼ëŠ” ì´ë¦„ì˜ 'ì‚¬ìš©ì ì •ë³´ ì–‘ì‹'ì„ ì •ì˜í•˜ì—¬ ì‚¬ìš©ìì˜ ê¸°ë³¸ì ì¸ ì •ë³´ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ì €ì¥í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.

**`django-server\Account\models.py`** íŒŒì¼ì˜ `CustomUser` ëª¨ë¸ì„ ì‚´í´ë³¼ê¹Œìš”?

```python
# django-server\Account\models.py (ì¼ë¶€)
from django.contrib.auth.models import AbstractUser, BaseUserManager
from django.db import models

class CustomUser(AbstractUser):
    # ì´ë©”ì¼ì„ ì£¼ ë¡œê·¸ì¸ í•„ë“œë¡œ ì‚¬ìš© (ì¤‘ë³µ ë¶ˆê°€)
    email = models.EmailField(unique=True, null=False, blank=False)
    USERNAME_FIELD = 'email' # Djangoì—ì„œ ì´ í•„ë“œë¥¼ ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •

    birth_date = models.DateField(null=True, blank=True) # ìƒë…„ì›”ì¼
    name = models.CharField(max_length=20, null=True, blank=True) # ì´ë¦„
    
    # ì„±ë³„ ì„ íƒ ì˜µì…˜ (ë‚¨ì„±, ì—¬ì„±)
    GENDER_CHOICES = [
        ('male', 'ë‚¨ì„±'),
        ('female', 'ì—¬ì„±'),
    ]
    gender = models.CharField(max_length=10, choices=GENDER_CHOICES, null=True, blank=True)
    
    is_verified = models.BooleanField(default=False) # ì´ë©”ì¼ ì¸ì¦ ì—¬ë¶€

    objects = CustomUserManager() # ìš°ë¦¬ë§Œì˜ ì‚¬ìš©ì ë§¤ë‹ˆì € ì‚¬ìš©

    def __str__(self):
        return self.email
```

ìœ„ ì½”ë“œëŠ” `CustomUser`ë¼ëŠ” ì‚¬ìš©ì ëª¨ë¸ì„ ì •ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì€ Djangoì˜ ê¸°ë³¸ ì‚¬ìš©ì ëª¨ë¸(`AbstractUser`)ì„ ìƒì†ë°›ì•„, `email` í•„ë“œë¥¼ ì£¼ ë¡œê·¸ì¸ í•„ë“œ(`USERNAME_FIELD`)ë¡œ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë˜í•œ, `birth_date`(ìƒë…„ì›”ì¼), `name`(ì´ë¦„), `gender`(ì„±ë³„), `is_verified`(ì´ë©”ì¼ ì¸ì¦ ì—¬ë¶€)ì™€ ê°™ì€ ìš°ë¦¬ ì„œë¹„ìŠ¤ì— í•„ìš”í•œ ì¶”ê°€ ì •ë³´ë“¤ì„ ì •ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. `is_verified` í•„ë“œëŠ” ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí–ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ë©°, ë³´ì•ˆìƒ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.

## 3. íšŒì›ê°€ì…: ìƒˆë¡œìš´ ì‹ ë¶„ì¦ ë°œê¸‰ë°›ê¸°

ìƒˆë¡œìš´ ì‚¬ìš©ìê°€ ìš°ë¦¬ ì„œë¹„ìŠ¤ì˜ íšŒì›ì´ ë˜ê¸° ìœ„í•´ íšŒì›ê°€ì…ì„ í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.

**ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤:**
1.  ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ 'íšŒì›ê°€ì…' ë§í¬ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
2.  íšŒì›ê°€ì… ëª¨ë‹¬(íŒì—…)ì´ ëœ¨ê³ , ì´ë¦„, ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸, ìƒë…„ì›”ì¼, ì„±ë³„ ì •ë³´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
3.  'íšŒì›ê°€ì…' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì„œë²„ë¡œ ì •ë³´ê°€ ì „ì†¡ë©ë‹ˆë‹¤.
4.  ì„œë²„ëŠ” ì •ë³´ë¥¼ ê²€ì¦í•˜ê³  ìƒˆ ê³„ì •ì„ ìƒì„±í•œ ë’¤, ì´ë©”ì¼ ì¸ì¦ ë©”ì¼ì„ ë°œì†¡í•©ë‹ˆë‹¤.
5.  ì‚¬ìš©ìëŠ” ë©”ì¼í•¨ì—ì„œ ì¸ì¦ ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ ê³„ì •ì„ í™œì„±í™”í•©ë‹ˆë‹¤.

### 3.1. ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤: `login.html`

ì‚¬ìš©ìê°€ íšŒì›ê°€ì… ì •ë³´ë¥¼ ì…ë ¥í•˜ëŠ” ë¶€ë¶„ì€ `django-server\templates\login\login.html` íŒŒì¼ì— ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```html
{# django-server\templates\login\login.html #}
<div id="signupModal" class="modal">
    <div class="modal-content">
        <span class="close-button" data-modal="signupModal">&times;</span>
        <h2>íšŒì›ê°€ì…</h2>
        <div class="modal-form-group">
            <label for="signupName">ì´ë¦„</label>
            <input type="text" id="signupName" class="modal-input">
        </div>
        <div class="modal-form-group">
            <label for="signupEmail">ì´ë©”ì¼</label>
            <input type="email" id="signupEmail" class="modal-input">
        </div>
        {# ... (ë¹„ë°€ë²ˆí˜¸, ìƒë…„ì›”ì¼, ì„±ë³„ ì…ë ¥ í•„ë“œ ìƒëµ) ... #}
        <button id="signupSubmitButton" class="btn btn-modal-action">íšŒì›ê°€ì…</button>
    </div>
</div>
```

ì´ HTML ì½”ë“œëŠ” íšŒì›ê°€ì…ì„ ìœ„í•œ ì…ë ¥ í•„ë“œ(`input`)ì™€ ë²„íŠ¼(`button`)ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì—¬ê¸°ì— ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´, ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ë³¼ `login.js`ê°€ ì´ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ì„œë²„ë¡œ ë³´ëƒ…ë‹ˆë‹¤.

### 3.2. í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ì—°ê²°: `login.js`

`django-server\static\js\login.js` íŒŒì¼ì€ ì‚¬ìš©ìê°€ ì…ë ¥í•œ íšŒì›ê°€ì… ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

```javascript
// django-server\static\js\login.js (ì¼ë¶€)
if (signupSubmitButton) {
    signupSubmitButton.addEventListener('click', async function(event) {
        event.preventDefault();

        const name = document.getElementById('signupName').value.trim();
        const email = document.getElementById('signupEmail').value.trim();
        const password = document.getElementById('signupPassword').value;
        const birth_date = document.getElementById('signupBirthdate').value;
        const gender_id_raw = document.getElementById('signupGenderId').value.trim();
        const gender_id = parseInt(gender_id_raw, 10); // ì„±ë³„ ID (1,2,3,4)

        // ... (ê°„ë‹¨í•œ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìœ íš¨ì„± ê²€ì‚¬ ìƒëµ) ...

        const userData = { // ì„œë²„ë¡œ ë³´ë‚¼ ë°ì´í„° ê°ì²´
            name: name,
            email: email,
            password: password,
            birth_date: birth_date,
            gender_id: gender_id // í”„ë¡ íŠ¸ì—ì„œëŠ” ìˆ«ìë¡œ ë°›ìŒ
        };

        try {
            const response = await fetch('/login/signup/', { // íšŒì›ê°€ì… API í˜¸ì¶œ
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken') // CSRF í† í°ì€ ë³´ì•ˆì„ ìœ„í•´ í•„ìˆ˜
                },
                body: JSON.stringify(userData)
            });

            const result = await response.json();

            if (response.ok) { // íšŒì›ê°€ì… ì„±ê³µ ì‹œ
                closeModal(signupModal);
                showSmallInfoPopup(`${name}ë‹˜, ì…ë ¥í•˜ì‹  ì´ë©”ì¼ë¡œ ì¸ì¦ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì¸ì¦ í›„ ë¡œê·¸ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.`);
                // ... (ì…ë ¥ í•„ë“œ ì´ˆê¸°í™” ìƒëµ) ...
            } else { // íšŒì›ê°€ì… ì‹¤íŒ¨ ì‹œ
                // ... (ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ë¦¬ ë° í‘œì‹œ) ...
                alert(errorMessage);
            }
        } catch (error) {
            console.error('Fetch error:', error);
            alert("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    });
}
```

ì´ JavaScript ì½”ë“œëŠ” 'íšŒì›ê°€ì…' ë²„íŠ¼ì´ í´ë¦­ë˜ë©´, ì…ë ¥ í•„ë“œì˜ ê°’ë“¤ì„ ê°€ì ¸ì™€ JSON í˜•ì‹ìœ¼ë¡œ ë§Œë“  í›„ `/login/signup/` API ì—”ë“œí¬ì¸íŠ¸ë¡œ `POST` ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤. ìš”ì²­ì´ ì„±ê³µí•˜ë©´ íšŒì›ê°€ì… ì„±ê³µ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì´ë©”ì¼ ì¸ì¦ì„ ìš”ì²­í•˜ëŠ” íŒì—…ì„ ë„ì›ë‹ˆë‹¤.

### 3.3. ë°±ì—”ë“œ ë°ì´í„° ì²˜ë¦¬: `serializers.py`

ì„œë²„ì—ì„œëŠ” ì‚¬ìš©ìê°€ ë³´ë‚¸ ë°ì´í„°ë¥¼ ê²€ì¦í•˜ê³  `CustomUser` ëª¨ë¸ì— ë§ê²Œ ë³€í™˜í•´ì•¼ í•©ë‹ˆë‹¤. ì´ ì—­í• ì„ `SignupSerializer`ê°€ ë‹´ë‹¹í•©ë‹ˆë‹¤.

**`django-server\Account\serializers.py`** íŒŒì¼ì˜ `SignupSerializer`ë¥¼ ì‚´í´ë³¼ê¹Œìš”?

```python
# django-server\Account\serializers.py (ì¼ë¶€)
from rest_framework import serializers
from django.contrib.auth import get_user_model

User = get_user_model()

class SignupSerializer(serializers.ModelSerializer):
    # ... (name, email, password, birth_date í•„ë“œ ì •ì˜ ìƒëµ) ...
    gender_id = serializers.IntegerField( # í”„ë¡ íŠ¸ì—ì„œ ë°›ì€ ìˆ«ì ID (1,2,3,4)
        help_text="ì„±ë³„ì„ ë‚˜íƒ€ë‚´ëŠ” ìˆ«ì (1,3: ë‚¨ì„±, 2,4: ì—¬ì„±)",
        min_value=1, max_value=4
    )

    class Meta:
        model = User
        fields = ('name', 'email', 'password', 'birth_date', 'gender_id')

    def validate(self, data):
        # 1. ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸
        if User.objects.filter(email=data.get('email')).exists():
            raise serializers.ValidationError({"email": "ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤."})
        
        # 2. ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ í™•ì¸ (ìµœì†Œ 8ì)
        if len(data.get('password')) < 8:
            raise serializers.ValidationError({"password": "ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤."})
        
        # 3. gender_idë¥¼ ì‹¤ì œ User ëª¨ë¸ì˜ 'gender' í•„ë“œ ê°’ìœ¼ë¡œ ë³€í™˜
        gender_id = data.get('gender_id')
        gender = None
        if gender_id in [1, 3]:
            gender = 'male'
        elif gender_id in [2, 4]:
            gender = 'female'
        data['gender'] = gender # `User` ëª¨ë¸ì˜ `gender` í•„ë“œì— í• ë‹¹ë  ê°’

        return data

    def create(self, validated_data):
        # gender_idëŠ” User ëª¨ë¸ í•„ë“œê°€ ì•„ë‹ˆë¯€ë¡œ ì œê±°
        validated_data.pop('gender_id') 
        # validate ë©”ì„œë“œì—ì„œ ì¶”ê°€í•œ 'gender' í•„ë“œë¥¼ ì‚¬ìš©
        gender = validated_data.pop('gender') 

        user = User.objects.create_user( # CustomUser ê°ì²´ ìƒì„±
            email=validated_data['email'],
            password=validated_data['password'],
            name=validated_data['name'],
            birth_date=validated_data['birth_date'],
            gender=gender, # ë³€í™˜ëœ gender ê°’ ì €ì¥
            is_verified=False # ì´ë©”ì¼ ì¸ì¦ ì „ì´ë¯€ë¡œ ê¸°ë³¸ê°’ False
        )
        return user
```

`SignupSerializer`ëŠ” ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë°ì´í„°ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì´ë©”ì¼ì´ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€, ë¹„ë°€ë²ˆí˜¸ê°€ ìµœì†Œ ê¸¸ì´ë¥¼ ë§Œì¡±í•˜ëŠ”ì§€ ë“±ì„ í™•ì¸í•©ë‹ˆë‹¤. íŠ¹íˆ, í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `gender_id`ë¼ëŠ” ìˆ«ìë¡œ ë°›ì€ ì„±ë³„ ì •ë³´(ì˜ˆ: ë‚¨ì„±ì€ 1, ì—¬ì„±ì€ 2)ë¥¼ ì‹¤ì œ `CustomUser` ëª¨ë¸ì˜ `gender` í•„ë“œì— ë§ëŠ” `'male'` ë˜ëŠ” `'female'` ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤. `create` ë©”ì„œë“œëŠ” ëª¨ë“  ê²€ì¦ì„ í†µê³¼í•œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‹¤ì œ `CustomUser` ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•©ë‹ˆë‹¤. ì´ë•Œ `is_verified`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `False`ë¡œ ì„¤ì •ë˜ì–´ ì´ë©”ì¼ ì¸ì¦ì´ í•„ìš”í•¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

### 3.4. API ìš”ì²­ ì²˜ë¦¬: `views.py`

ì‹¤ì œ íšŒì›ê°€ì… ìš”ì²­ì„ ë°›ì•„ì„œ `SignupSerializer`ë¥¼ í˜¸ì¶œí•˜ê³  ì‚¬ìš©ì ê³„ì •ì„ ìƒì„±í•˜ëŠ” ê²ƒì€ `SignupAPIView`ê°€ ë‹´ë‹¹í•©ë‹ˆë‹¤.

**`django-server\Account\views.py`** íŒŒì¼ì˜ `SignupAPIView`ë¥¼ ì‚´í´ë³¼ê¹Œìš”?

```python
# django-server\Account\views.py (ì¼ë¶€)
from rest_framework import generics, status
from rest_framework.response import Response
from allauth.account.utils import send_email_confirmation # ì´ë©”ì¼ ì¸ì¦ ê¸°ëŠ¥
from .serializers import SignupSerializer
from django.contrib.auth import get_user_model

User = get_user_model()

class SignupAPIView(generics.CreateAPIView):
    queryset = User.objects.all()
    serializer_class = SignupSerializer
    permission_classes = [] # ëˆ„êµ¬ë‚˜ íšŒì›ê°€ì… ê°€ëŠ¥í•˜ë„ë¡ í—ˆìš©

    def post(self, request, *args, **kwargs):
        serializer = self.get_serializer(data=request.data)
        serializer.is_valid(raise_exception=True) # ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë°˜í™˜
        user = serializer.save() # `SignupSerializer`ì˜ create() ë©”ì„œë“œ í˜¸ì¶œ, ì‚¬ìš©ì ìƒì„±

        # íšŒì›ê°€ì… í›„ ì´ë©”ì¼ ì¸ì¦ ë©”ì¼ ë°œì†¡
        try:
            send_email_confirmation(request, user)
        except Exception as e:
            print(f"ì¸ì¦ ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: {e}")
            # ì´ë©”ì¼ ì „ì†¡ ì‹¤íŒ¨ëŠ” íšŒì›ê°€ì… ì‹¤íŒ¨ë¡œ ì´ì–´ì§€ì§€ ì•Šê²Œ ì²˜ë¦¬í•  ìˆ˜ë„ ìˆìŒ
            return Response({
                "message": "íšŒì›ê°€ì…ì€ ì™„ë£Œë˜ì—ˆìœ¼ë‚˜, ì¸ì¦ ë©”ì¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
                "user_email": user.email,
            }, status=status.HTTP_201_CREATED)

        return Response({
            "message": "íšŒì›ê°€ì…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì¸ì¦ ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.",
            "user_email": user.email,
        }, status=status.HTTP_201_CREATED)
```

`SignupAPIView`ëŠ” `POST` ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ `SignupSerializer`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê³ , ê²€ì¦ëœ ë°ì´í„°ë¡œ `user` ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²ƒì€ `send_email_confirmation(request, user)` í•¨ìˆ˜ì…ë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” `django-allauth` ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ, ê°€ì…ëœ ì‚¬ìš©ìì—ê²Œ ì´ë©”ì¼ ì¸ì¦ì„ ìœ„í•œ ë©”ì¼ì„ ìë™ìœ¼ë¡œ ë°œì†¡í•©ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì´ ë©”ì¼ì— í¬í•¨ëœ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ ê³„ì •ì´ í™œì„±í™”ë˜ê³ , `CustomUser` ëª¨ë¸ì˜ `is_verified` í•„ë“œê°€ `True`ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.

### 3.5. ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ ì²˜ë¦¬: `signals.py`

ì‚¬ìš©ìê°€ ì¸ì¦ ë©”ì¼ì˜ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ `django-allauth` ë‚´ë¶€ì ìœ¼ë¡œ `email_confirmed` ì‹œê·¸ë„(ì‹ í˜¸)ì„ ë°œìƒì‹œí‚µë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì´ ì‹œê·¸ë„ì„ ê°ì§€í•˜ì—¬ ì‚¬ìš©ìì˜ `is_verified` í•„ë“œë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

**`django-server\Account\signals.py`** íŒŒì¼ì˜ ì¼ë¶€ì…ë‹ˆë‹¤.

```python
# Account/signals.py (ì¼ë¶€)
from allauth.account.signals import email_confirmed
from django.dispatch import receiver
from django.contrib.auth import get_user_model

User = get_user_model()

@receiver(email_confirmed)
def update_user_is_verified(sender, request, email_address, **kwargs):
    """
    ì´ë©”ì¼ ì¸ì¦ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆì„ ë•Œ í˜¸ì¶œë˜ëŠ” ì‹œê·¸ë„ í•¸ë“¤ëŸ¬.
    ì‚¬ìš©ì ëª¨ë¸ì˜ is_verified í•„ë“œë¥¼ Trueë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
    """
    try:
        user = User.objects.get(email=email_address.email)
        if not user.is_verified: # ì´ë¯¸ ì¸ì¦ë˜ì—ˆë‹¤ë©´ ë¶ˆí•„ìš”í•œ ì €ì¥ ë°©ì§€
            user.is_verified = True
            user.save()
            print(f"ì‚¬ìš©ì {user.email}ì˜ ì´ë©”ì¼ ì¸ì¦ ìƒíƒœê°€ Trueë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.")
    except User.DoesNotExist:
        print(f"ì˜¤ë¥˜: ì´ë©”ì¼ ì¸ì¦ì„ ìœ„í•œ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {email_address.email}")
```

`@receiver(email_confirmed)` ë°ì½”ë ˆì´í„°ëŠ” `email_confirmed` ì‹œê·¸ë„ì´ ë°œìƒí•  ë•Œ `update_user_is_verified` í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë„ë¡ ë“±ë¡í•©ë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œëœ ì‚¬ìš©ìì˜ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ë°›ì•„ í•´ë‹¹ `CustomUser` ê°ì²´ë¥¼ ì°¾ì€ í›„, `is_verified` í•„ë“œë¥¼ `True`ë¡œ ë³€ê²½í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•©ë‹ˆë‹¤. ì´ì œ ì´ ì‚¬ìš©ìëŠ” 'ì¸ì¦ëœ' ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

## 4. ë¡œê·¸ì¸: ë°œê¸‰ë°›ì€ ì‹ ë¶„ì¦ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì…ì¥í•˜ê¸°

íšŒì›ê°€ì… ë° ì´ë©”ì¼ ì¸ì¦ì„ ë§ˆì¹œ ì‚¬ìš©ìëŠ” ì´ì œ ìì‹ ì˜ ê³„ì •ìœ¼ë¡œ ì„œë¹„ìŠ¤ì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤:**
1.  ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
2.  'ë¡œê·¸ì¸' ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
3.  ì„œë²„ëŠ” ì…ë ¥ëœ ì •ë³´ë¡œ ì‚¬ìš©ìë¥¼ ì¸ì¦í•˜ê³ , ì„±ê³µí•˜ë©´ JWT(JSON Web Token)ë¥¼ ë°œê¸‰í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ì „ë‹¬í•©ë‹ˆë‹¤.
4.  ì‚¬ìš©ìì˜ ì›¹ ë¸Œë¼ìš°ì €ëŠ” ì´ í† í°ì„ ì €ì¥í•˜ê³ , ì´í›„ ì„œë¹„ìŠ¤ ì´ìš© ì‹œ ì´ í† í°ì„ 'ì´ìš© í—ˆê°€ì¦'ì²˜ëŸ¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

### 4.1. ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤: `login.html`

ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ëŠ” HTML ë¶€ë¶„ì€ ì•ì„œ ë³¸ íšŒì›ê°€ì… ëª¨ë‹¬ê³¼ í•¨ê»˜ `django-server\templates\login\login.html` íŒŒì¼ì— ìˆìŠµë‹ˆë‹¤.

```html
{# django-server\templates\login\login.html #}
<div class="login-container">
    <div class="login-right">
        <form id="loginForm">
            <div class="form-group">
                <label for="email">ì´ë©”ì¼</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit" class="btn btn-login">ë¡œê·¸ì¸</button>
            <a href="{% provider_login_url 'google' %}" class="btn btn-google">Google ê³„ì • ë¡œê·¸ì¸</a>
        </form>
    </div>
</div>
```

ì´ ì½”ë“œëŠ” ì‚¬ìš©ìê°€ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆëŠ” ê°„ë‹¨í•œ ë¡œê·¸ì¸ í¼ì„ ì œê³µí•©ë‹ˆë‹¤. Google ì†Œì…œ ë¡œê·¸ì¸ ë²„íŠ¼ë„ ëˆˆì— ë„ëŠ”ë°, ì´ëŠ” ë‚˜ì¤‘ì— ë‹¤ì‹œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

### 4.2. í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ì—°ê²°: `login.js` ë° `login_success.html`

`django-server\static\js\login.js`ëŠ” ë¡œê·¸ì¸ í¼ì´ ì œì¶œë  ë•Œ ì„œë²„ì˜ ë¡œê·¸ì¸ APIë¡œ ë°ì´í„°ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.

```javascript
// django-server\static\js\login.js (ì¼ë¶€)
if (loginForm) {
    loginForm.addEventListener('submit', async function (e) {
        e.preventDefault();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;

        // ... (ìœ íš¨ì„± ê²€ì‚¬ ìƒëµ) ...

        try {
            const response = await fetch('/login/login/', { // ë¡œê·¸ì¸ API í˜¸ì¶œ
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken') },
                body: JSON.stringify({ email: email, password: password })
            });

            const result = await response.json();

            if (response.ok) { // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ
                console.log("ë¡œê·¸ì¸ ì„±ê³µ! í† í°:", result.access, result.refresh);
                localStorage.setItem('accessToken', result.access); // Access Token ì €ì¥
                localStorage.setItem('refreshToken', result.refresh); // Refresh Token ì €ì¥
                window.location.href = '/'; // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
            } else { // ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ
                // ... (ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ë¦¬ ë° í‘œì‹œ) ...
                showLoginFailedPopup('ë¡œê·¸ì¸ ì‹¤íŒ¨', errorMessage);
            }
        } catch (error) {
            console.error('ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜:', error);
            showLoginFailedPopup('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜', 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
    });
}
```

ì´ ì½”ë“œëŠ” ë¡œê·¸ì¸ í¼ì´ ì œì¶œë˜ë©´ ì…ë ¥ëœ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ `/login/login/` APIë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ì„œë²„ë¡œë¶€í„° `response.ok` (ì„±ê³µ) ì‘ë‹µì„ ë°›ìœ¼ë©´, ì„œë²„ê°€ ë°œê¸‰í•œ `accessToken`ê³¼ `refreshToken`ì„ ì›¹ ë¸Œë¼ìš°ì €ì˜ `localStorage`ì— ì €ì¥í•©ë‹ˆë‹¤. ì´ í† í°ë“¤ì€ ë§ˆì¹˜ ì„œë¹„ìŠ¤ ì´ìš© 'í—ˆê°€ì¦'ì²˜ëŸ¼ ì‘ë™í•˜ì—¬, ì´í›„ ì‚¬ìš©ìê°€ ìš”ì²­ì„ ë³´ë‚¼ ë•Œë§ˆë‹¤ ìì‹ ì´ ëˆ„êµ¬ì¸ì§€ ì¦ëª…í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

ì†Œì…œ ë¡œê·¸ì¸(Google)ì˜ ê²½ìš°, Django `allauth` ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ íë¦„ì„ ë”°ë¦…ë‹ˆë‹¤. Google ë¡œê·¸ì¸ ì„±ê³µ ì‹œ `django-server\templates\login\login_success.html` í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜ë˜ë©°, ì´ í˜ì´ì§€ì—ì„œ ì„œë²„ê°€ ì„¸ì…˜ì— ì €ì¥í•œ JWT í† í°ì„ `localStorage`ë¡œ ì˜®ê¹ë‹ˆë‹¤.

```html
<!-- templates/login/login_success.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¡œê·¸ì¸ ì„±ê³µ</title>
</head>
<body>
  <h1>ë¡œê·¸ì¸ ì¤‘ì…ë‹ˆë‹¤...</h1>

  <!-- Django í…œí”Œë¦¿ í•„í„°ë¡œ JWT ë°ì´í„°ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ì‚½ì… -->
  {{ request.session.jwt|json_script:"jwt-data" }}

  <script>
    try {
      const token = JSON.parse(document.getElementById('jwt-data').textContent);
      if (token.access && token.refresh) {
        localStorage.setItem("accessToken", token.access);
        localStorage.setItem("refreshToken", token.refresh);
        console.log("âœ… JWT ì €ì¥ ì™„ë£Œ");
      } else {
        console.warn("âš ï¸ í† í°ì´ ì—†ìŠµë‹ˆë‹¤.");
      }
    } catch (e) {
      console.error("ğŸš¨ í† í° íŒŒì‹± ì¤‘ ì˜¤ë¥˜:", e);
    }

    // í™ˆìœ¼ë¡œ ì´ë™
    window.location.href = "/";
  </script>
</body>
</html>
```
ì´ `login_success.html`ì€ ì¼ë°˜ ë¡œê·¸ì¸ ë˜ëŠ” ì†Œì…œ ë¡œê·¸ì¸ ì‹œ `JWT` í† í°ì„ ì›¹ ë¸Œë¼ìš°ì €ì˜ `localStorage`ì— ì €ì¥í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ì €ì¥ëœ í† í°ì„ ì´ìš©í•´ ì‚¬ìš©ìëŠ” ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì—¬ ì„œë¹„ìŠ¤ ì´ìš©ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 4.3. ë°±ì—”ë“œ ì¸ì¦ ì²˜ë¦¬: `views.py`

ë¡œê·¸ì¸ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” `LoginAPIView`ëŠ” ì‚¬ìš©ìì˜ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°›ì•„ ì¸ì¦ ì ˆì°¨ë¥¼ ìˆ˜í–‰í•˜ê³ , ì„±ê³µ ì‹œ JWT í† í°ì„ ë°œê¸‰í•©ë‹ˆë‹¤.

**`django-server\Account\views.py`** íŒŒì¼ì˜ `LoginAPIView`ë¥¼ ì‚´í´ë³¼ê¹Œìš”?

```python
# django-server\Account\views.py (ì¼ë¶€)
from rest_framework import generics, status
from rest_framework.response import Response
from django.contrib.auth import authenticate # Django ê¸°ë³¸ ì¸ì¦ í•¨ìˆ˜
from rest_framework_simplejwt.tokens import RefreshToken # JWT í† í° ìƒì„±

class LoginAPIView(generics.GenericAPIView):
    permission_classes = [] # ëˆ„êµ¬ë‚˜ ë¡œê·¸ì¸ ìš”ì²­ ê°€ëŠ¥í•˜ë„ë¡ í—ˆìš©

    def post(self, request, *args, **kwargs):
        email = request.data.get('email')
        password = request.data.get('password')

        if not email or not password:
            return Response({"detail": "ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”."}, status=status.HTTP_400_BAD_REQUEST)

        # Djangoì˜ authenticate í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì¸ì¦ ì‹œë„
        user = authenticate(request, username=email, password=password) 

        if user is None: # ì¸ì¦ ì‹¤íŒ¨ (ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜)
            return Response({"detail": "ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."}, status=status.HTTP_401_UNAUTHORIZED)
        
        # ì´ë©”ì¼ ì¸ì¦ ì—¬ë¶€ í™•ì¸
        if not user.is_verified:
            return Response({"detail": "ì´ë©”ì¼ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”."}, status=status.HTTP_403_FORBIDDEN)

        # ì¸ì¦ ì„±ê³µ ë° ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ ì‹œ, JWT í† í° ë°œê¸‰
        refresh = RefreshToken.for_user(user) # Refresh Token ìƒì„±
        # Refresh Tokenìœ¼ë¡œë¶€í„° Access Token ì¶”ì¶œ

        return Response({
            'message': 'ë¡œê·¸ì¸ ì„±ê³µ!',
            'access': str(refresh.access_token), # Access Token ë°˜í™˜
            'refresh': str(refresh), # Refresh Token ë°˜í™˜
            'user_id': user.id,
            'user_email': user.email,
        }, status=status.HTTP_200_OK)
```

`LoginAPIView`ì˜ `post` ë©”ì„œë“œëŠ” ì‚¬ìš©ìê°€ ë³´ë‚¸ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¡œ `authenticate` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ì‚¬ìš©ìë¥¼ ì¸ì¦í•©ë‹ˆë‹¤. ì´ `authenticate` í•¨ìˆ˜ëŠ” `settings.py`ì— ì„¤ì •ëœ `AUTHENTICATION_BACKENDS`ë¥¼ í†µí•´ `CustomUser` ëª¨ë¸ì— ëŒ€í•´ ì¸ì¦ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì¸ì¦ì— ì„±ê³µí•˜ë©´ ì‚¬ìš©ìì˜ `is_verified` í•„ë“œë¥¼ í™•ì¸í•˜ì—¬ ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. ëª¨ë“  ì¡°ê±´ì´ ì¶©ì¡±ë˜ë©´ `rest_framework_simplejwt` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ `Refresh Token`ê³¼ `Access Token`ì„ ìƒì„±í•˜ê³ , ì´ í† í°ë“¤ì„ ì‚¬ìš©ìì—ê²Œ ì‘ë‹µìœ¼ë¡œ ë³´ëƒ…ë‹ˆë‹¤.

### 4.4. JWT(JSON Web Token)ë¡œ ì¸ì¦ ìœ ì§€í•˜ê¸°: `auth.js`

ë¡œê·¸ì¸ ì‹œ ë°œê¸‰ë°›ì€ `accessToken`ê³¼ `refreshToken`ì€ ì‚¬ìš©ìê°€ ì›¹ í˜ì´ì§€ë¥¼ ì´ë™í•˜ê±°ë‚˜ ë‹¤ë¥¸ APIë¥¼ í˜¸ì¶œí•  ë•Œ ìì‹ ì´ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì„ì„ ì¦ëª…í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. `django-server\static\js\auth.js` íŒŒì¼ì€ ì´ëŸ¬í•œ í† í°ì„ ê´€ë¦¬í•˜ê³ , í•„ìš”í•œ ê²½ìš° ìƒˆë¡œìš´ í† í°ì„ ë°œê¸‰ë°›ëŠ” ë¡œì§ì„ í¬í•¨í•©ë‹ˆë‹¤.

```javascript
// django-server\static\js\auth.js (ì¼ë¶€)
async function checkUserAuthentication() {
    let accessToken = localStorage.getItem('accessToken');
    const refreshToken = localStorage.getItem('refreshToken');

    // 1. Access Tokenì´ ì—†ëŠ” ê²½ìš°: ë¡œê·¸ì¸ í•„ìš”
    if (!accessToken) {
        console.log("Access Tokenì´ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.");
        return false;
    }

    // 2. Access Token ìœ íš¨ì„± ê²€ì‚¬ (ì„œë²„ì— í™•ì¸)
    try {
        const verifyResponse = await fetch('/api/token/verify/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${accessToken}`, 'X-CSRFToken': getCookie('csrftoken') },
            body: JSON.stringify({ token: accessToken })
        });

        if (verifyResponse.ok) {
            console.log("Access Tokenì´ ìœ íš¨í•©ë‹ˆë‹¤.");
            return true; // Access Token ìœ íš¨, ì¸ì¦ ì™„ë£Œ
        } else if (verifyResponse.status === 401) {
            // Access Tokenì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•ŠìŒ -> Refresh Tokenìœ¼ë¡œ ì¬ë°œê¸‰ ì‹œë„
            console.warn("Access Token ë§Œë£Œ ë˜ëŠ” ìœ íš¨í•˜ì§€ ì•ŠìŒ. Refresh Token ì‹œë„ ì¤‘...");
            
            if (!refreshToken) {
                console.error("Refresh Tokenì´ ì—†ìŠµë‹ˆë‹¤. Access Tokenì„ ê°±ì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                logoutUser(); // ê°•ì œ ë¡œê·¸ì•„ì›ƒ
                return false;
            }

            const refreshResponse = await fetch('/api/token/refresh/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken') },
                body: JSON.stringify({ refresh: refreshToken })
            });

            if (refreshResponse.ok) {
                const data = await refreshResponse.json();
                localStorage.setItem('accessToken', data.access); // ìƒˆ Access Token ì €ì¥
                console.log("Access Token ê°±ì‹  ì„±ê³µ.");
                return true; // ìƒˆ Access Tokenìœ¼ë¡œ ì¸ì¦ ì™„ë£Œ
            } else if (refreshResponse.status === 401) {
                console.error("Refresh Tokenë§ˆì € ë§Œë£Œ ë˜ëŠ” ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.");
                logoutUser(); // Refresh Tokenë§ˆì € ë§Œë£Œ, ê°•ì œ ë¡œê·¸ì•„ì›ƒ
                return false;
            } else {
                console.error("í† í° ê°±ì‹  ì‹¤íŒ¨:", await refreshResponse.json());
                logoutUser();
                return false;
            }
        } else {
            console.error("í† í° ê²€ì¦ ì‹¤íŒ¨ ìƒíƒœ:", verifyResponse.status, await verifyResponse.json());
            logoutUser(); // ê·¸ ì™¸ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ëŠ” ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
            return false;
        }

    } catch (error) {
        console.error("ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜ ë°œìƒ:", error);
        logoutUser();
        return false;
    }
}
```

`checkUserAuthentication` í•¨ìˆ˜ëŠ” ì‚¬ìš©ìê°€ íŠ¹ì • ë™ì‘ì„ ìˆ˜í–‰í•˜ê¸° ì „, í˜„ì¬ ê°€ì§€ê³  ìˆëŠ” `accessToken`ì´ ìœ íš¨í•œì§€ ì„œë²„ì— í™•ì¸í•©ë‹ˆë‹¤. ë§Œì•½ `accessToken`ì´ ë§Œë£Œë˜ì—ˆë‹¤ë©´, `refreshToken`ì„ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ `accessToken`ì„ ë°œê¸‰ë°›ìœ¼ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì„ í†µí•´ ì‚¬ìš©ìëŠ” ë§¤ë²ˆ ë¡œê·¸ì¸í•  í•„ìš” ì—†ì´ ì„œë¹„ìŠ¤ ì´ìš©ì„ ì§€ì†í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ `refreshToken`ë§ˆì € ìœ íš¨í•˜ì§€ ì•Šë‹¤ë©´, ì‚¬ìš©ìëŠ” ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

## 5. ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°: ìƒì–´ë²„ë¦° ì‹ ë¶„ì¦ ì¬ë°œê¸‰ë°›ê¸°

ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠì–´ë²„ë¦° ì‚¬ìš©ìë¥¼ ìœ„í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤. í¬ê²Œ 'ì´ë©”ì¼ ì°¾ê¸°'ì™€ 'ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •' ë‘ ê°€ì§€ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.

**ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° íë¦„:**

```mermaid
sequenceDiagram
    participant ì‚¬ìš©ì as ì‚¬ìš©ì (ì›¹ ë¸Œë¼ìš°ì €)
    participant ì›¹ì„œë²„_AccountAPI as ì›¹ ì„œë²„ (Django)
    participant DB as ë°ì´í„°ë² ì´ìŠ¤
    participant ì´ë©”ì¼_ì„œë²„ as ì´ë©”ì¼ ì„œë²„
    
    alt ì´ë©”ì¼ ì°¾ê¸°
        ì‚¬ìš©ì->>ì›¹ì„œë²„_AccountAPI: ì´ë©”ì¼ ì°¾ê¸° ìš”ì²­ (ì´ë¦„, ìƒë…„ì›”ì¼)
        ì›¹ì„œë²„_AccountAPI->>ì›¹ì„œë²„_AccountAPI: FindEmailSerializerë¡œ ìœ íš¨ì„± ê²€ì‚¬
        ì›¹ì„œë²„_AccountAPI->>DB: ì´ë¦„, ìƒë…„ì›”ì¼ë¡œ ì‚¬ìš©ì ì´ë©”ì¼ ì¡°íšŒ
        DB-->>ì›¹ì„œë²„_AccountAPI: ì´ë©”ì¼ ë°˜í™˜
        ì›¹ì„œë²„_AccountAPI-->>ì‚¬ìš©ì: ì°¾ì€ ì´ë©”ì¼ ì£¼ì†Œ ë°˜í™˜
    else ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • (ìš”ì²­)
        ì‚¬ìš©ì->>ì›¹ì„œë²„_AccountAPI: ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ìš”ì²­ (ì´ë¦„, ì´ë©”ì¼, ìƒë…„ì›”ì¼)
        ì›¹ì„œë²„_AccountAPI->>ì›¹ì„œë²„_AccountAPI: PasswordResetRequestSerializerë¡œ ìœ íš¨ì„± ê²€ì‚¬ ë° ì‚¬ìš©ì ì¡°íšŒ
        ì›¹ì„œë²„_AccountAPI->>ì›¹ì„œë²„_AccountAPI: ì¬ì„¤ì • í† í°/UID ìƒì„±
        ì›¹ì„œë²„_AccountAPI->>ì´ë©”ì¼_ì„œë²„: ì¬ì„¤ì • ë§í¬ í¬í•¨ ì´ë©”ì¼ ë°œì†¡
        ì´ë©”ì¼_ì„œë²„-->>ì‚¬ìš©ì: ì¬ì„¤ì • ë©”ì¼ ì „ì†¡ (ë§í¬ í´ë¦­ ìœ ë„)
        ì›¹ì„œë²„_AccountAPI-->>ì‚¬ìš©ì: ì¬ì„¤ì • ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ ì‘ë‹µ
    end
    
    ì‚¬ìš©ì->>ì›¹ì„œë²„_AccountAPI: ì¬ì„¤ì • ë§í¬ í´ë¦­ (URLì— uidb64, token í¬í•¨)
    ì›¹ì„œë²„_AccountAPI-->>ì‚¬ìš©ì: ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ëª¨ë‹¬/í˜ì´ì§€ í‘œì‹œ (í”„ë¡ íŠ¸ì—”ë“œ ì²˜ë¦¬)
    ì‚¬ìš©ì->>ì›¹ì„œë²„_AccountAPI: ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (SetNewPasswordAPIView)
    ì›¹ì„œë²„_AccountAPI->>ì›¹ì„œë²„_AccountAPI: SetNewPasswordWithTokenSerializerë¡œ í† í°/ë¹„ë²ˆ ìœ íš¨ì„± ê²€ì‚¬
    ì›¹ì„œë²„_AccountAPI->>DB: ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ ì—…ë°ì´íŠ¸
    DB-->>ì›¹ì„œë²„_AccountAPI: ë¹„ë°€ë²ˆí˜¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ
    ì›¹ì„œë²„_AccountAPI-->>ì‚¬ìš©ì: ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì„±ê³µ ë©”ì‹œì§€
```

### 5.1. ë°±ì—”ë“œ API: `views.py`

`django-server\Account\views.py`ì—ëŠ” ì´ë©”ì¼ ì°¾ê¸°ì™€ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •ì„ ìœ„í•œ ì„¸ ê°€ì§€ API ë·°ê°€ ìˆìŠµë‹ˆë‹¤.

*   **`FindEmailAPIView`**: ì´ë¦„ê³¼ ìƒë…„ì›”ì¼ì„ ë°›ì•„ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì°¾ì•„ì¤ë‹ˆë‹¤.

    ```python
    # django-server\Account\views.py (ì¼ë¶€)
    class FindEmailAPIView(generics.GenericAPIView):
        permission_classes = [] # ì¸ì¦ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥
        serializer_class = FindEmailSerializer

        def post(self, request, *args, **kwargs):
            serializer = self.get_serializer(data=request.data)
            serializer.is_valid(raise_exception=True) # ì´ë¦„, ìƒë…„ì›”ì¼ë¡œ ì‚¬ìš©ì ì°¾ê¸°
            user = serializer.validated_data['user'] # ì°¾ì€ ì‚¬ìš©ì ê°ì²´

            return Response({
                "message": "ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.",
                "email": user.email, # ì°¾ì€ ì´ë©”ì¼ ë°˜í™˜
            }, status=status.HTTP_200_OK)
    ```

*   **`PasswordResetRequestAPIView`**: ì´ë¦„, ì´ë©”ì¼, ìƒë…„ì›”ì¼ì„ ë°›ì•„ ì‚¬ìš©ì ì¸ì¦ í›„ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ê°€ í¬í•¨ëœ ì´ë©”ì¼ì„ ë°œì†¡í•©ë‹ˆë‹¤.

    ```python
    # django-server\Account\views.py (ì¼ë¶€)
    class PasswordResetRequestAPIView(generics.GenericAPIView):
        permission_classes = []
        serializer_class = PasswordResetRequestSerializer

        def post(self, request, *args, **kwargs):
            serializer = self.get_serializer(data=request.data)
            serializer.is_valid(raise_exception=True)
            user = serializer.validated_data['user'] # ì‚¬ìš©ì ì¸ì¦

            # ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ ìƒì„± (UID, í† í° í¬í•¨)
            uid = urlsafe_base64_encode(force_bytes(user.pk))
            token = default_token_generator.make_token(user)
            reset_link = f"{request.scheme}://{get_current_site(request).domain}/login/?action=reset_password&uidb64={uid}&token={token}"

            # ì´ë©”ì¼ í…œí”Œë¦¿ ë Œë”ë§ ë° ë°œì†¡
            # ... (render_to_string, EmailMultiAlternatives ì‚¬ìš©) ...
            email_message.send(fail_silently=False)

            return Response({
                "message": f"ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì´ë©”ì¼ì„ {user.email}ë¡œ ë°œì†¡í–ˆìŠµë‹ˆë‹¤.",
            }, status=status.HTTP_200_OK)
    ```

*   **`SetNewPasswordAPIView`**: ì´ë©”ì¼ë¡œ ë°›ì€ ë§í¬ì˜ `uidb64` (ì‚¬ìš©ì ID)ì™€ `token` (ì¸ì¦ í† í°), ê·¸ë¦¬ê³  ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°›ì•„ ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤.

    ```python
    # django-server\Account\views.py (ì¼ë¶€)
    class SetNewPasswordAPIView(generics.GenericAPIView):
        permission_classes = []
        serializer_class = SetNewPasswordWithTokenSerializer

        def post(self, request, *args, **kwargs):
            serializer = self.get_serializer(data=request.data)
            serializer.is_valid(raise_exception=True) # í† í°, UID, ìƒˆ ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
            
            user = serializer.validated_data['user']
            new_password = serializer.validated_data['new_password']

            user.set_password(new_password) # ë¹„ë°€ë²ˆí˜¸ í•´ì‹± ë° ì—…ë°ì´íŠ¸
            user.save()

            return Response({
                "message": "ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì¬ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.",
            }, status=status.HTTP_200_OK)
    ```
ê° API ë·°ëŠ” í•´ë‹¹í•˜ëŠ” `Serializer`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ ë°ì´í„°ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•©ë‹ˆë‹¤. `FindEmailAPIView`ëŠ” ì´ë¦„ê³¼ ìƒë…„ì›”ì¼ë¡œ ì‚¬ìš©ìë¥¼ ì°¾ì•„ ì´ë©”ì¼ì„ ë°˜í™˜í•˜ê³ , `PasswordResetRequestAPIView`ëŠ” ì‚¬ìš©ìì—ê²Œ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ë¥¼ ì´ë©”ì¼ë¡œ ë³´ëƒ…ë‹ˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ `SetNewPasswordAPIView`ëŠ” ì´ë©”ì¼ ë§í¬ë¥¼ í†µí•´ ë°›ì€ `uid`ì™€ `token`ì„ ê²€ì¦í•œ í›„, ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ë¡œ ì‚¬ìš©ìì˜ ê³„ì •ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

### 5.2. í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™: `login.js`

`django-server\static\js\login.js`ëŠ” "ì´ë©”ì¼ ì°¾ê¸°" ë° "ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ê³ , URLì— ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • `uid`ì™€ `token`ì´ ìˆì„ ê²½ìš° ìë™ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ëª¨ë‹¬ì„ ë„ì›ë‹ˆë‹¤.

```javascript
// django-server\static\js\login.js (ì¼ë¶€)

// "ì´ë©”ì¼ ì°¾ê¸°" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
if (findEmailButton) {
    findEmailButton.addEventListener('click', async function() {
        const name = document.getElementById('findEmailName').value.trim();
        const birth_date = document.getElementById('findEmailIdentifier').value;
        // ... (ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡ ë° ì‘ë‹µ ì²˜ë¦¬) ...
        const response = await fetch('/login/find-email/', { /* ... */ });
        const result = await response.json();
        if (response.ok) {
            showSmallInfoPopup(`ê³ ê°ë‹˜ì˜ ì´ë©”ì¼ ì£¼ì†ŒëŠ”<br><b>${result.email}</b> ì…ë‹ˆë‹¤.`);
        } else { /* ... */ }
    });
}

// "ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ì¬ì„¤ì • ìš”ì²­)
if (findPasswordButton) {
    findPasswordButton.addEventListener('click', async function() {
        // ... (ì…ë ¥ í•„ë“œ ê°’ ê°€ì ¸ì˜¤ê¸°) ...
        const response = await fetch('/login/password-reset-request/', { /* ... */ });
        const result = await response.json();
        if (response.ok) {
            closeModal(findCredentialsModal);
            showSmallInfoPopup(result.message);
        } else { /* ... */ }
    });
}

// URL íŒŒë¼ë¯¸í„°ì—ì„œ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì •ë³´ í™•ì¸ í›„ ëª¨ë‹¬ ë„ìš°ê¸°
const urlParams = new URLSearchParams(window.location.search);
const action = urlParams.get('action');
const uidb64 = urlParams.get('uidb64');
const token = urlParams.get('token');

if (action === 'reset_password' && uidb64 && token) {
    globalUidb64 = uidb64; // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (ì´í›„ ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •ì— ì‚¬ìš©)
    globalToken = token;
    openModal(resetPasswordModal); // ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ëª¨ë‹¬ ì—´ê¸°
    window.history.replaceState({}, document.title, window.location.pathname); // URL ì •ë¦¬
}

// "ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •" ëª¨ë‹¬ - "ì €ì¥" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
if (saveNewPasswordButton) {
    saveNewPasswordButton.addEventListener('click', async function() {
        const newPassword = document.getElementById('newPassword').value;
        const confirmNewPassword = document.getElementById('confirmNewPassword').value;
        // ... (ìœ íš¨ì„± ê²€ì‚¬ ë° ì„œë²„ ì „ì†¡) ...
        const response = await fetch('/login/set-new-password/', { /* ... */ });
        const result = await response.json();
        if (response.ok) {
            closeModal(resetPasswordModal);
            showSmallInfoPopup('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„±ê³µì ìœ¼ë¡œ<br>ë³€ê²½í–ˆìŠµë‹ˆë‹¤.');
            window.location.href = '/login/'; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        } else { /* ... */ }
    });
}
```

ì´ ì½”ë“œëŠ” ì‚¬ìš©ìê°€ `login.html`ì˜ "ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°" ëª¨ë‹¬ì—ì„œ ê° ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ í•´ë‹¹í•˜ëŠ” APIë¥¼ í˜¸ì¶œí•˜ê³ , ì‘ë‹µì— ë”°ë¼ íŒì—… ë©”ì‹œì§€ë¥¼ ë„ì›ë‹ˆë‹¤. íŠ¹íˆ, ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì´ë©”ì¼ì˜ ë§í¬ë¥¼ í†µí•´ í˜ì´ì§€ì— ì ‘ê·¼í–ˆì„ ë•ŒëŠ” URLì˜ `uidb64`ì™€ `token` íŒŒë¼ë¯¸í„°ë¥¼ ì½ì–´ ìë™ìœ¼ë¡œ "ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •" ëª¨ë‹¬ì„ ë„ì›Œ ì‚¬ìš©ì ê²½í—˜ì„ ë§¤ë„ëŸ½ê²Œ í•©ë‹ˆë‹¤.

## 6. ì†Œì…œ ë¡œê·¸ì¸: ê°„í¸í•˜ê²Œ ì‹ ë¶„ì¦ ë°œê¸‰ë°›ê¸° (Google)

êµ¬ê¸€(Google)ê³¼ ê°™ì€ ì†Œì…œ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ëŠ” ê²ƒì€ ì‚¬ìš©ìì—ê²Œ ë§¤ìš° í¸ë¦¬í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ìš°ë¦¬ ì„œë¹„ìŠ¤ëŠ” `django-allauth` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ Google ë¡œê·¸ì¸ì„ ì§€ì›í•©ë‹ˆë‹¤.

**`django-server\config\settings.py`** íŒŒì¼ì—ëŠ” Google ì†Œì…œ ë¡œê·¸ì¸ì„ ìœ„í•œ ì„¤ì •ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```python
# django-server\config\settings.py (ì¼ë¶€)
INSTALLED_APPS = [
    # ...
    'django.contrib.sites',
    'allauth',
    'allauth.account',
    'allauth.socialaccount',
    'allauth.socialaccount.providers.google', # Google Provider ì¶”ê°€
    # ...
]

AUTHENTICATION_BACKENDS = (
    'django.contrib.auth.backends.ModelBackend',
    'allauth.account.auth_backends.AuthenticationBackend', # allauth ë°±ì—”ë“œ
)

SOCIALACCOUNT_ADAPTER ='Account.adapters.CustomSocialAccountAdapter' # ì»¤ìŠ¤í…€ ì–´ëŒ‘í„° ì‚¬ìš©

SOCIALACCOUNT_PROVIDERS = {
    'google': {
        'APP': {
            'client_id': os.environ.get("GOOGLE_CLIENT_ID"), # êµ¬ê¸€ ê°œë°œì ì½˜ì†”ì—ì„œ ë°œê¸‰ë°›ì€ ID
            'secret': os.environ.get("GOOGLE_CLIENT_SECRET"), # êµ¬ê¸€ ê°œë°œì ì½˜ì†”ì—ì„œ ë°œê¸‰ë°›ì€ Secret
            'key': ''
        },
        'SCOPE': [ # êµ¬ê¸€ë¡œë¶€í„° ë°›ì•„ì˜¬ ì‚¬ìš©ì ì •ë³´ ë²”ìœ„
            'profile',
            'email',
        ],
        'AUTH_PARAMS': {
            'access_type': 'offline', # Refresh Tokenì„ ë°›ê¸° ìœ„í•´ í•„ìš”
        }
    }
}
```

ì´ ì„¤ì •ì€ `django-allauth`ê°€ Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆë„ë¡ í•„ìš”í•œ ëª¨ë“ˆë“¤ì„ ë“±ë¡í•˜ê³ , Google APIì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ `client_id`ì™€ `secret`ì„ ì •ì˜í•©ë‹ˆë‹¤. ë˜í•œ, `SCOPE`ë¥¼ í†µí•´ Googleë¡œë¶€í„° ì‚¬ìš©ìì˜ í”„ë¡œí•„ ì •ë³´(ì´ë¦„, ì„± ë“±)ì™€ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆë„ë¡ ìš”ì²­í•©ë‹ˆë‹¤.

**`django-server\Account\adapters.py`** íŒŒì¼ì˜ `CustomSocialAccountAdapter`ëŠ” ì†Œì…œ ë¡œê·¸ì¸ ì‹œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

```python
# django-server\Account\adapters.py (ì¼ë¶€)
from allauth.socialaccount.adapter import DefaultSocialAccountAdapter
from django.contrib.auth import get_user_model

User = get_user_model()

class CustomSocialAccountAdapter(DefaultSocialAccountAdapter):
    def save_user(self, request, sociallogin, form=None):
        user = super().save_user(request, sociallogin, form) # ê¸°ë³¸ ì‚¬ìš©ì ì €ì¥ ë¡œì§ ì‹¤í–‰

        # Google ë¡œê·¸ì¸ ì‹œ ì‚¬ìš©ìì˜ 'is_verified' í•„ë“œë¥¼ Trueë¡œ ì„¤ì • (ì´ë¯¸ ì¸ì¦ë˜ì—ˆë‹¤ê³  ê°„ì£¼)
        if not user.is_verified:
            user.is_verified = True
            user.save(update_fields=['is_verified'])

        # Google ê³„ì •ì—ì„œ ì´ë¦„ ì •ë³´ë¥¼ ê°€ì ¸ì™€ 'name' í•„ë“œ ì—…ë°ì´íŠ¸
        data = sociallogin.account.extra_data
        first_name_from_social = data.get('given_name', '')
        last_name_from_social = data.get('family_name', '')
        combined_name = f"{last_name_from_social}{first_name_from_social}".strip()

        if not user.name: # user.nameì´ ë¹„ì–´ìˆì„ ë•Œë§Œ ì—…ë°ì´íŠ¸
            user.name = combined_name
            user.save(update_fields=['name'])

        return user
    
    def respond_social_login_success(self, request, sociallogin):
        # ì†Œì…œ ë¡œê·¸ì¸ ì„±ê³µ ì‹œ JWT í† í°ì„ ë°œê¸‰í•˜ì—¬ í”„ë¡ íŠ¸ë¡œ ì „ë‹¬
        from rest_framework_simplejwt.tokens import RefreshToken
        from django.shortcuts import render

        user = sociallogin.user
        refresh = RefreshToken.for_user(user)
        
        # ì„¸ì…˜ì— JWT í† í° ì €ì¥ (login_success.htmlì—ì„œ ì‚¬ìš©)
        request.session['jwt'] = {
            'access': str(refresh.access_token),
            'refresh': str(refresh),
        }
        return render(request, 'login/login_success.html', {
            'access': str(refresh.access_token),
            'refresh': str(refresh),
        })
```

`CustomSocialAccountAdapter`ëŠ” Google ë¡œê·¸ì¸ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œëœ í›„, ìš°ë¦¬ `CustomUser` ëª¨ë¸ì— ë§ê²Œ ì¶”ê°€ì ì¸ ì²˜ë¦¬ë¥¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì†Œì…œ ë¡œê·¸ì¸ì€ ì´ë¯¸ ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œëœ ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ì—¬ `is_verified` í•„ë“œë¥¼ `True`ë¡œ ì„¤ì •í•˜ê³ , Googleì—ì„œ ê°€ì ¸ì˜¨ ì´ë¦„ ì •ë³´ë¥¼ `name` í•„ë“œì— ì €ì¥í•©ë‹ˆë‹¤. ë˜í•œ, `respond_social_login_success` ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œ(ì¬ì •ì˜)í•˜ì—¬ ì¼ë°˜ ë¡œê·¸ì¸ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ JWT í† í°ì„ ìƒì„±í•˜ê³ , ì´ë¥¼ `login_success.html` í…œí”Œë¦¿ìœ¼ë¡œ ì „ë‹¬í•˜ì—¬ ì›¹ ë¸Œë¼ìš°ì €ì˜ `localStorage`ì— ì €ì¥í•˜ë„ë¡ í•©ë‹ˆë‹¤.

## 7. ì „ì²´ì ì¸ íë¦„: ì‚¬ìš©ìì˜ ì—¬ì •

ì§€ê¸ˆê¹Œì§€ ì„¤ëª…í•œ íšŒì›ê°€ì…, ë¡œê·¸ì¸, ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°, ì†Œì…œ ë¡œê·¸ì¸ ê¸°ëŠ¥ë“¤ì´ ì–´ë–»ê²Œ ìœ ê¸°ì ìœ¼ë¡œ ì—°ê²°ë˜ì–´ ì‚¬ìš©ìì˜ ê³„ì • ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ëŠ”ì§€ í° ê·¸ë¦¼ìœ¼ë¡œ ì •ë¦¬í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```mermaid
graph TD
    subgraph ì‹œì‘ì 
        A[ì‚¬ìš©ì ë°©ë¬¸] --> B{ê³„ì • ìˆìŒ?}
    end
    
    subgraph ê³„ì •ìƒì„±ë°ì¸ì¦["ê³„ì • ìƒì„± ë° ì¸ì¦"]
        C[íšŒì›ê°€ì… ìš”ì²­]
        C1[ì´ë¦„, ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ ë“± ì…ë ¥]
        C2[ì„œë²„ì— ê°€ì… ìš”ì²­ SignupAPIView]
        C3[CustomUser ìƒì„± is_verified=False]
        C4[ì´ë©”ì¼ ì¸ì¦ ë©”ì¼ ë°œì†¡]
        C5{ì‚¬ìš©ì ë©”ì¼ í™•ì¸ í›„ ë§í¬ í´ë¦­}
        C6[ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ is_verified=True]
        
        C --> C1
        C1 --> C2
        C2 --> C3
        C3 --> C4
        C4 --> C5
        C5 -->|ë„¤| C6
    end
    
    subgraph ë¡œê·¸ì¸ë°í† í°ê´€ë¦¬["ë¡œê·¸ì¸ ë° í† í° ê´€ë¦¬"]
        D[ë¡œê·¸ì¸ ìš”ì²­]
        D1[ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ ì…ë ¥]
        D2[ì„œë²„ì— ë¡œê·¸ì¸ ìš”ì²­ LoginAPIView]
        D3{ì¸ì¦ ì„±ê³µ ë° is_verified=True?}
        D4[JWT Access Token, Refresh Token ë°œê¸‰]
        D5[í† í° ì›¹ ë¸Œë¼ìš°ì € localStorageì— ì €ì¥]
        D6[ë¡œê·¸ì¸ ì‹¤íŒ¨/ì¸ì¦ í•„ìš” ë©”ì‹œì§€]
        
        E[ì„œë¹„ìŠ¤ ì´ìš© API ìš”ì²­ ì‹œ Access Token ì‚¬ìš©]
        E1{Access Token ë§Œë£Œ?}
        E2[Refresh Tokenìœ¼ë¡œ Access Token ì¬ë°œê¸‰ auth.js]
        E3[API í˜¸ì¶œ ì„±ê³µ]
        F{Refresh Tokenë„ ë§Œë£Œ?}
        
        D --> D1
        D1 --> D2
        D2 --> D3
        D3 -->|ë„¤| D4
        D4 --> D5
        D3 -->|ì•„ë‹ˆìš”| D6
        
        D5 --> E
        E --> E1
        E1 -->|ë„¤| E2
        E1 -->|ì•„ë‹ˆìš”| E3
        E2 --> E3
        E2 --> F
        F -->|ë„¤| D6
    end
    
    subgraph ë¹„ë°€ë²ˆí˜¸ì¬ì„¤ì •["ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •"]
        G[ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ë§í¬ í´ë¦­]
        G1{ì´ë©”ì¼ ì°¾ê¸° ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •?}
        G2[ì´ë¦„, ìƒë…„ì›”ì¼ë¡œ ì´ë©”ì¼ ì¡°íšŒ FindEmailAPIView]
        G3[ì´ë¦„, ì´ë©”ì¼, ìƒë…„ì›”ì¼ë¡œ ì¬ì„¤ì • ìš”ì²­ PasswordResetRequestAPIView]
        G4[ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ ì´ë©”ì¼ ë°œì†¡]
        G5{ì‚¬ìš©ì ë©”ì¼ ë§í¬ í´ë¦­}
        G6[ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • SetNewPasswordAPIView]
        G7[ë¹„ë°€ë²ˆí˜¸ ì—…ë°ì´íŠ¸]
        
        G --> G1
        G1 -->|ì´ë©”ì¼ ì°¾ê¸°| G2
        G1 -->|ë¹„ë²ˆ ì¬ì„¤ì •| G3
        G3 --> G4
        G4 --> G5
        G5 -->|ë„¤| G6
        G6 --> G7
    end
    
    subgraph ì†Œì…œë¡œê·¸ì¸["ì†Œì…œ ë¡œê·¸ì¸"]
        H[Google ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­]
        H1[Google ì¸ì¦ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜]
        H2[Google ì¸ì¦ ì„±ê³µ]
        H3[CustomSocialAccountAdapterë¡œ ì‚¬ìš©ì ì •ë³´ ì²˜ë¦¬]
        H4[JWT Access/Refresh Token ë°œê¸‰]
        
        H --> H1
        H1 --> H2
        H2 --> H3
        H3 --> H4
    end
    
    Z[ì„œë¹„ìŠ¤ ê³„ì† ì´ìš©]
    
    %% ì£¼ìš” ì—°ê²°
    B -->|ì•„ë‹ˆìš”| C
    B -->|ì˜ˆ| D
    C6 --> D
    D6 --> G
    D --> H
    H4 --> D5
    E3 --> Z
    Z --> D
    G7 --> D
```

ì´ ë‹¤ì´ì–´ê·¸ë¨ì€ ì‚¬ìš©ìê°€ ìš°ë¦¬ ì„œë¹„ìŠ¤ì— ì²˜ìŒ ì ‘ì†í•˜ëŠ” ìˆœê°„ë¶€í„° ê³„ì •ì„ ë§Œë“¤ê³ , ë¡œê·¸ì¸í•˜ë©°, í•„ìš”í•œ ê²½ìš° ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•˜ê±°ë‚˜ ì†Œì…œ ë¡œê·¸ì¸ì„ í†µí•´ í¸ë¦¬í•˜ê²Œ ì ‘ì†í•˜ëŠ” ì „ì²´ì ì¸ ì—¬ì •ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ëª¨ë“  ê³¼ì •ì—ì„œ ë³´ì•ˆê³¼ ì‚¬ìš©ì ê²½í—˜ì„ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤í•˜ì—¬ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

## ê²°ë¡ 

ì´ë²ˆ ì±•í„°ì—ì„œëŠ” `ì‚¬ìš©ì ê³„ì • ê´€ë¦¬`ë¼ëŠ” ì¤‘ìš”í•œ ê°œë…ê³¼ ê·¸ êµ¬í˜„ ë°©ì‹ì— ëŒ€í•´ ê¹Šì´ ìˆê²Œ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤. ì‚¬ìš©ìì˜ 'ì‹ ë¶„ì¦ ë°œê¸‰ì†Œ' ë¹„ìœ ë¥¼ í†µí•´ íšŒì›ê°€ì…, ë¡œê·¸ì¸, ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°, ì†Œì…œ ë¡œê·¸ì¸, ì´ë©”ì¼ ì¸ì¦ ë“± ê³„ì • ìƒëª…ì£¼ê¸° ì „ë°˜ì— ê±¸ì¹œ ê¸°ëŠ¥ì„ ì´í•´í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

íŠ¹íˆ, `CustomUser` ëª¨ë¸ì„ í†µí•´ ì‚¬ìš©ì ì •ë³´ë¥¼ ì •ì˜í•˜ê³ , Django REST Frameworkì˜ `Serializer`ì™€ `APIView`ë¥¼ í™œìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•, ê·¸ë¦¬ê³  `django-allauth` ë° `rest_framework_simplejwt` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ ì¸ì¦ê³¼ JWT ê¸°ë°˜ì˜ ê°•ë ¥í•œ ì¸ì¦ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ëŠ” ê³¼ì •ê¹Œì§€ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. í”„ë¡ íŠ¸ì—”ë“œ(`login.js`, `auth.js`, `login.html`)ì™€ ë°±ì—”ë“œ(`models.py`, `serializers.py`, `views.py`, `adapters.py`, `signals.py`, `settings.py`)ê°€ ì–´ë–»ê²Œ ìƒí˜¸ì‘ìš©í•˜ëŠ”ì§€ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

ì´ì œ ìš°ë¦¬ëŠ” ì‚¬ìš©ìê°€ ì•ˆì „í•˜ê²Œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ë°˜ì„ ë§ˆë ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ì±•í„°ì—ì„œëŠ” ì´ë ‡ê²Œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë¥¼ ìœ„í•œ ê°œì¸í™”ëœ ì„œë¹„ìŠ¤, ì¦‰ [ë§ˆì´í˜ì´ì§€ ê°œì¸í™” ê¸°ëŠ¥](04_ë§ˆì´í˜ì´ì§€_ê°œì¸í™”_ê¸°ëŠ¥_.md)ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

[ì±•í„° 4: ë§ˆì´í˜ì´ì§€ ê°œì¸í™” ê¸°ëŠ¥](04_ë§ˆì´í˜ì´ì§€_ê°œì¸í™”_ê¸°ëŠ¥_.md)

---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)